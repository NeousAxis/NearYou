/* empty css              */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();const b={fr:{heroTitle:"Trouvez ce que<br>vous cherchez.",heroSubtitle:"Scannez n'importe quel objet pour d√©couvrir les meilleures adresses autour de vous.",analyzing:"Analyse intelligente...",nearby:"√Ä proximit√©",sortDistance:"Proche",sortPrice:"Prix",detected:"D√©tect√© :",newSearch:"Nouvelle recherche",alertGeo:"üìç Veuillez autoriser la g√©olocalisation dans R√©glages ‚Üí Safari ‚Üí Position",alertError:"‚ùå Une erreur s'est produite. Veuillez r√©essayer.",choiceTitle:"Que cherchez-vous ?",choiceDetected:"Nous avons d√©tect√© :",categories:{"Fournitures de bureau":"Fournitures de bureau",Alimentation:"Alimentation"},physical:"Physique",physical:"Physique",online:"En ligne",howItWorksTitle:"Comment √ßa marche ?",step1Title:"Scannez",step1Desc:"Prenez une photo de n'importe quel objet.",step2Title:"Analysez",step2Desc:"Notre IA identifie l'objet instantan√©ment.",step3Title:"Trouvez (Physique)",step3Desc:"D√©couvrez les magasins autour de vous.",step4Title:"Achetez (En ligne)",step4Desc:"Acc√©dez aux meilleures offres sur le web."},en:{heroTitle:"Find what<br>you need.",heroSubtitle:"Scan any object to discover the best places around you.",analyzing:"Smart analyzing...",nearby:"Nearby",sortDistance:"Closest",sortPrice:"Price",detected:"Detected:",newSearch:"New Search",alertGeo:"üìç Please allow location access in Settings ‚Üí Safari ‚Üí Location",alertError:"‚ùå An error occurred. Please try again.",choiceTitle:"What are you looking for?",choiceDetected:"We detected:",categories:{"Fournitures de bureau":"Office Supplies",Alimentation:"Food & Drink"},physical:"Physical",physical:"Physical",online:"Online",howItWorksTitle:"How it works?",step1Title:"Scan",step1Desc:"Take a photo of any object.",step2Title:"Analyze",step2Desc:"Our AI identifies the object instantly.",step3Title:"Find (Physical)",step3Desc:"Discover shops around you.",step4Title:"Buy (Online)",step4Desc:"Get the best deals on the web."},vi:{heroTitle:"T√¨m nh·ªØng g√¨<br>b·∫°n c·∫ßn.",heroSubtitle:"Qu√©t b·∫•t k·ª≥ ƒë·ªì v·∫≠t n√†o ƒë·ªÉ kh√°m ph√° nh·ªØng ƒë·ªãa ƒëi·ªÉm t·ªët nh·∫•t xung quanh b·∫°n.",analyzing:"ƒêang ph√¢n t√≠ch...",nearby:"G·∫ßn ƒë√¢y",sortDistance:"G·∫ßn nh·∫•t",sortPrice:"Gi√°",detected:"ƒê√£ ph√°t hi·ªán:",newSearch:"T√¨m ki·∫øm m·ªõi",alertGeo:"Vui l√≤ng cho ph√©p ƒë·ªãnh v·ªã.",choiceTitle:"B·∫°n ƒëang t√¨m ki·∫øm g√¨?",choiceDetected:"Ch√∫ng t√¥i ƒë√£ ph√°t hi·ªán:",categories:{"Fournitures de bureau":"VƒÉn ph√≤ng ph·∫©m",Alimentation:"Th·ª±c ph·∫©m & ƒê·ªì u·ªëng"},howItWorksTitle:"L√†m th·∫ø n√†o n√≥ ho·∫°t ƒë·ªông?",step1Title:"Qu√©t",step1Desc:"Ch·ª•p ·∫£nh b·∫•t k·ª≥ ƒë·ªì v·∫≠t n√†o.",step2Title:"Ph√¢n t√≠ch",step2Desc:"AI c·ªßa ch√∫ng t√¥i nh·∫≠n di·ªán ƒë·ªì v·∫≠t ngay l·∫≠p t·ª©c.",step3Title:"T√¨m (Th·ª±c t·∫ø)",step3Desc:"Kh√°m ph√° c√°c c·ª≠a h√†ng xung quanh b·∫°n.",step4Title:"Mua (Tr·ª±c tuy·∫øn)",step4Desc:"Nh·∫≠n c√°c ∆∞u ƒë√£i t·ªët nh·∫•t tr√™n web."},es:{heroTitle:"Encuentra lo que<br>buscas.",heroSubtitle:"Escanea cualquier objeto para descubrir los mejores lugares a tu alrededor.",analyzing:"Analizando...",nearby:"Cerca de ti",sortDistance:"Cercan√≠a",sortPrice:"Precio",detected:"Detectado:",newSearch:"Nueva b√∫squeda",alertGeo:"Por favor permite la geolocalizaci√≥n.",choiceTitle:"¬øQu√© est√°s buscando?",choiceDetected:"Detectamos:",categories:{"Fournitures de bureau":"Art√≠culos de oficina",Alimentation:"Alimentaci√≥n"},howItWorksTitle:"¬øC√≥mo funciona?",step1Title:"Escanear",step1Desc:"Toma una foto de cualquier objeto.",step2Title:"Analizar",step2Desc:"Nuestra IA identifica el objeto al instante.",step3Title:"Encontrar (F√≠sico)",step3Desc:"Descubre tiendas a tu alrededor.",step4Title:"Comprar (En l√≠nea)",step4Desc:"Obt√©n las mejores ofertas en la web."},de:{heroTitle:"Finde, was<br>du suchst.",heroSubtitle:"Scanne ein Objekt, um die besten Orte in deiner N√§he zu entdecken.",analyzing:"Analysieren...",nearby:"In der N√§he",sortDistance:"Entfernung",sortPrice:"Preis",detected:"Erkannt:",newSearch:"Neue Suche",alertGeo:"Bitte Standortfreigabe aktivieren.",choiceTitle:"Wonach suchst du?",choiceDetected:"Wir haben erkannt:",categories:{"Fournitures de bureau":"B√ºrobedarf",Alimentation:"Lebensmittel"},howItWorksTitle:"Wie funktioniert es?",step1Title:"Scannen",step1Desc:"Mach ein Foto von einem beliebigen Objekt.",step2Title:"Analysieren",step2Desc:"Unsere KI identifiziert das Objekt sofort.",step3Title:"Finden (Physisch)",step3Desc:"Entdecke Gesch√§fte in deiner N√§he.",step4Title:"Kaufen (Online)",step4Desc:"Erhalte die besten Angebote im Web."},it:{heroTitle:"Trova ci√≤ che<br>cerchi.",heroSubtitle:"Scansiona qualsiasi oggetto per scoprire i posti migliori intorno a te.",analyzing:"Analisi in corso...",nearby:"Nelle vicinanze",sortDistance:"Vicinanza",sortPrice:"Prezzo",detected:"Rilevato:",newSearch:"Nuova ricerca",alertGeo:"Si prega di consentire la geolocalizzazione.",choiceTitle:"Cosa stai cercando?",choiceDetected:"Abbiamo rilevato:",categories:{"Fournitures de bureau":"Forniture per ufficio",Alimentation:"Alimentari"},howItWorksTitle:"Come funziona?",step1Title:"Scansiona",step1Desc:"Scatta una foto di qualsiasi oggetto.",step2Title:"Analizza",step2Desc:"La nostra IA identifica l'oggetto all'istante.",step3Title:"Trova (Fisico)",step3Desc:"Scopri i negozi intorno a te.",step4Title:"Compra (Online)",step4Desc:"Ottieni le migliori offerte sul web."}},z="nearyou_state_v1";function _(){const e={userLocation:null,sortBy:"distance",searchMode:"physical",results:[],detectedCategory:null,language:H(),pendingAnalysis:null,currentView:"search",actualSearchTerm:null,fallbackInfo:null};try{const t=localStorage.getItem(z);if(t){const n=JSON.parse(t);return{...e,...n,pendingAnalysis:null}}}catch(t){console.error("Error loading state:",t)}return e}const o=_();function L(){try{const e={...o,pendingAnalysis:null};localStorage.setItem(z,JSON.stringify(e))}catch(e){console.error("Error saving state:",e)}}const D=document.getElementById("file-input"),M=document.getElementById("scan-btn"),G=document.getElementById("logo-btn"),E=document.getElementById("search-view"),S=document.getElementById("loading-view"),x=document.getElementById("choice-view"),I=document.getElementById("results-view"),g=document.getElementById("results-grid"),R=document.getElementById("reset-btn"),k=document.querySelectorAll(".chip"),C=document.getElementById("detected-badge"),P=document.getElementById("detected-label"),B=document.getElementById("lang-select"),j=document.getElementById("detected-item"),$=document.getElementById("choice-btn-1"),F=document.getElementById("choice-btn-2"),v=document.getElementById("choice-btn-3"),y=document.getElementById("mode-toggle"),h=document.getElementById("label-physical"),m=document.getElementById("label-online"),A=document.getElementById("sort-controls");B.value=o.language;N(o.language);M.addEventListener("click",()=>D.click());G.addEventListener("click",()=>{o.results=[],o.detectedCategory=null,o.searchMode="physical",y.checked=!1,m.classList.remove("active"),h.classList.add("active"),p("search")});o.currentView==="results"&&o.results.length>0?(o.searchMode==="online"?(y.checked=!0,m.classList.add("active"),h.classList.remove("active")):(y.checked=!1,m.classList.remove("active"),h.classList.add("active")),k.forEach(e=>{e.classList.toggle("active",e.dataset.sort===o.sortBy)}),w(),p("results")):(o.searchMode="physical",y.checked=!1,m.classList.remove("active"),h.classList.add("active"),o.currentView&&p(o.currentView));function H(){const e=localStorage.getItem("nearyou_lang");return e&&b[e]?e:"en"}function N(e){o.language=e,localStorage.setItem("nearyou_lang",e);const t=b[e];if(document.querySelectorAll("[data-i18n]").forEach(n=>{const s=n.dataset.i18n;t[s]&&(n.innerHTML=t[s])}),o.detectedCategory){const n=b[e].categories[o.detectedCategory]||o.detectedCategory;P.textContent=n}}function V(e){return"‚Ç¨".repeat(e)}function w(){if(g.innerHTML="",o.searchMode==="online"){oe(),A.classList.add("hidden");return}if(A.classList.remove("hidden"),o.detectedCategory){const t=o.language,n=b[t].categories[o.detectedCategory]||o.detectedCategory;P.textContent=n,C.classList.remove("hidden")}else C.classList.add("hidden");let e=[...o.results];if(o.sortBy==="distance"?e.sort((t,n)=>t.distance-n.distance):o.sortBy==="price"&&e.sort((t,n)=>t.price-n.price),e.length===0){const{latitude:t,longitude:n}=o.userLocation,s=`https://www.google.com/maps?q=${t},${n}`;g.innerHTML=`
      <div class="no-results">
        <p>Aucun lieu trouv√© pour "${o.actualSearchTerm||o.detectedCategory}".</p>
        <div style="font-size: 12px; color: #666; margin-top: 10px; text-align: left; background: #f5f5f5; padding: 10px; border-radius: 8px;">
            <p><strong>Debug Info:</strong></p>
            <p>üìç Position: <a href="${s}" target="_blank" style="color: blue; text-decoration: underline;">${t.toFixed(5)}, ${n.toFixed(5)}</a> (Cliquez pour v√©rifier)</p>
            <p>üîç Recherche: ${o.actualSearchTerm||"G√©n√©rique"}</p>
            <p>üìÇ Cat√©gorie: ${o.detectedCategory||"Inconnue"}</p>
            <p>üìè Rayon: 50 km</p>
        </div>
        <p class="sub" style="margin-top: 15px;">Essayez une autre recherche ou √©largissez la zone.</p>
      </div>
    `;return}if(g.innerHTML="",o.fallbackInfo&&o.fallbackInfo.tier>1&&o.fallbackInfo.message){const t=document.createElement("div");t.style.cssText="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 20px; border-radius: 8px; grid-column: 1 / -1;",t.innerHTML=`<p style="margin: 0; color: #856404; font-size: 14px;">‚ÑπÔ∏è ${o.fallbackInfo.message}</p>`,g.appendChild(t)}if(e.forEach((t,n)=>{const s=`https://www.google.com/maps/dir/?api=1&destination=${t.lat},${t.lng}`,i=document.createElement("div");if(i.className="place-card",i.innerHTML=`
      <img src="${t.image}" alt="${t.name}" class="place-image">
      <div class="place-details">
        <div class="place-category">${t.category}</div>
        <div class="place-name">${t.name}</div>
        <div class="place-address">${t.address}</div>
        <div class="place-footer">
          <a href="${s}" target="_blank" class="place-distance" title="Voir l'itin√©raire">
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
            ${t.distance.toFixed(1)} km
          </a>
          <div class="place-price">${V(t.price)}</div>
        </div>
      </div>
    `,g.appendChild(i),(n+1)%2===0&&n!==e.length-1){const a=document.createElement("div");a.className="place-card ad-card",a.innerHTML=`
        <div class="ad-label">Publicit√©</div>
        <ins class="adsbygoogle"
             style="display:block"
           data-ad-client="ca-pub-9057470154911774"
             data-ad-slot="9453283378"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script>
      `,g.appendChild(a)}}),e.length===1){const t=document.createElement("div");t.className="place-card ad-card",t.innerHTML=`
      <div class="ad-label">Publicit√©</div>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-9057470154911774"
           data-ad-slot="9453283378"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script>
    `,g.appendChild(t)}}function p(e){E.classList.add("hidden"),S.classList.add("hidden"),x.classList.add("hidden"),I.classList.add("hidden"),e==="search"?E.classList.remove("hidden"):e==="loading"?S.classList.remove("hidden"):e==="choice"?x.classList.remove("hidden"):e==="results"&&I.classList.remove("hidden"),o.currentView=e,L()}B.addEventListener("change",e=>{N(e.target.value),L()});D.addEventListener("change",e=>{o.searchMode="physical",y.checked=!1,m.classList.remove("active"),h.classList.add("active"),e.target.files&&e.target.files[0]&&U(e.target.files[0])});R.addEventListener("click",()=>{o.results=[],o.detectedCategory=null,o.actualSearchTerm=null,o.fallbackInfo=null,o.searchMode="physical",y.checked=!1,m.classList.remove("active"),h.classList.add("active"),p("search")});y.addEventListener("change",e=>{o.searchMode=e.target.checked?"online":"physical",L(),o.searchMode==="online"?(m.classList.add("active"),h.classList.remove("active")):(m.classList.remove("active"),h.classList.add("active")),w()});k.forEach(e=>{e.addEventListener("click",()=>{k.forEach(t=>t.classList.remove("active")),e.classList.add("active"),o.sortBy=e.dataset.sort,w()})});async function U(e){var t,n;p("loading");try{console.log("Step 1: Getting location...");const s=await X(),{latitude:i,longitude:a}=s.coords;o.userLocation={latitude:i,longitude:a},console.log("‚úì Location obtained:",i,a);const r=document.getElementById("debug-coords");r&&(r.innerText=`Lat: ${i.toFixed(5)}, Lng: ${a.toFixed(5)}`),console.log("Step 2: Compressing image...");const l=await K(e);console.log("‚úì Image compressed"),console.log("Step 3: Converting to base64...");const c=await W(l);console.log("‚úì Image converted, size:",c.length),console.log("Step 4: Calling OpenAI API...");const u=await J(c,"image/jpeg");console.log("‚úì Analysis received:",u),o.pendingAnalysis=u,Y(u)}catch(s){if(console.error("‚ùå Error details:",s),console.error("Error stack:",s.stack),s.code===1||(t=s.message)!=null&&t.includes("geolocation")||(n=s.message)!=null&&n.includes("location"))alert(b[o.language].alertGeo);else{const i=s.message||"Unknown error";alert(`${b[o.language].alertError}

Details: ${i}`)}p("search")}}function W(e){return new Promise((t,n)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>{const i=s.result.split(",")[1];t(i)},s.onerror=i=>n(i)})}function K(e,t=800,n=.8){return new Promise((s,i)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=r=>{const l=new Image;l.src=r.target.result,l.onload=()=>{const c=document.createElement("canvas");let u=l.width,f=l.height;u>t&&(f=f*t/u,u=t),c.width=u,c.height=f,c.getContext("2d").drawImage(l,0,0,u,f),c.toBlob(d=>{d?(console.log(`Image compressed: ${(e.size/1024).toFixed(1)}KB ‚Üí ${(d.size/1024).toFixed(1)}KB`),s(d)):i(new Error("Image compression failed"))},"image/jpeg",n)},l.onerror=i},a.onerror=i})}function Q(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;return e.includes("Ho_Chi_Minh")?"Vietnam":e.includes("Paris")?"France":e.includes("Berlin")?"Germany":e.includes("New_York")||e.includes("Los_Angeles")?"USA":e.includes("Stockholm")?"Sweden":"Global"}async function J(e,t){try{const n=await fetch("/api/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,mimeType:t,language:o.language,userCountry:Q()})});if(!n.ok){const s=await n.text();throw console.error("API Error Response:",s),new Error(`API request failed (${n.status}): ${s}`)}return await n.json()}catch(n){throw console.error("analyzeWithAPI error:",n),n}}function Y(e){j.textContent=e.item,$.querySelector(".choice-label").textContent=e.option1.label,F.querySelector(".choice-label").textContent=e.option2.label,e.option3?(v.classList.remove("hidden"),v.querySelector(".choice-label").textContent=e.option3.label):v.classList.add("hidden"),e.online_recommendations?o.aiRecommendations=e.online_recommendations:o.aiRecommendations=null,p("choice")}async function T(e){const t=o.pendingAnalysis;let n;e===1?n=t.option1:e===2?n=t.option2:n=t.option3;const s=e===1;o.detectedCategory=n.category;let i=n.search_term;i&&(i=i.replace(/(https?:\/\/)?(www\.)?/gi,"").replace(/\.(com|vn|net|org|edu|gov)(\.vn)?/gi,"").trim()),p("loading");const{latitude:a,longitude:r}=o.userLocation,l=document.getElementById("debug-coords");l&&(l.innerText=`Lat: ${a.toFixed(5)}, Lng: ${r.toFixed(5)}`),o.actualSearchTerm=i||"G√©n√©rique";const c=await Z(a,r,n.category,t.item,i,s);o.results=c.results||[],o.fallbackInfo=c.fallbackInfo,w(),p("results")}$.addEventListener("click",()=>T(1));F.addEventListener("click",()=>T(2));v.addEventListener("click",()=>T(3));async function Z(e,t,n,s,i,a){try{const r={latitude:e,longitude:t,category:n,radius:5e4};a&&i&&i.length>2&&(r.query=i);const l=await fetch("/api/search-places",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!l.ok){const d=await l.text();throw console.error("Search API Error:",d),new Error(`Search failed (${l.status}): ${d}`)}const c=await l.json();if(!c.results||c.results.length===0)return[];const u={tier:c.fallback_tier||1,message:c.fallback_message};return{results:c.results.map(d=>({id:d.id,name:d.name,category:d.category,address:d.address,image:`https://source.unsplash.com/200x200/?${encodeURIComponent(n)}&sig=${d.id}`,price:d.price,distance:d.distance,lat:d.lat,lng:d.lng})).sort((d,q)=>d.distance-q.distance).slice(0,20),fallbackInfo:u}}catch(r){return console.error("Search error:",r),[]}}function X(){return console.log("Requesting geolocation..."),new Promise((e,t)=>{if(!navigator.geolocation){t(new Error("Geolocation not supported"));return}const n={enableHighAccuracy:!0,timeout:15e3,maximumAge:0};navigator.geolocation.getCurrentPosition(s=>{console.log("Geolocation success (High Accuracy):",s.coords.latitude,s.coords.longitude),e(s)},s=>{console.warn("High accuracy geolocation failed, trying low accuracy...",s),navigator.geolocation.getCurrentPosition(i=>{console.log("Geolocation success (Low Accuracy):",i.coords.latitude,i.coords.longitude),e(i)},i=>{console.error("Geolocation failed completely:",i),t(i)},{enableHighAccuracy:!1,timeout:15e3,maximumAge:0})},n)})}function ee(){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;if(e.includes("Paris"))return"FR";if(e.includes("Berlin"))return"DE";if(e.includes("Rome"))return"IT";if(e.includes("Madrid"))return"ES";if(e.includes("London"))return"GB";if(e.includes("Stockholm"))return"SE";if(e.includes("Ho_Chi_Minh")||e.includes("Bangkok"))return"VN";if(e.includes("New_York")||e.includes("Los_Angeles")||e.includes("Chicago"))return"US";if(o.userLocation){const{latitude:t,longitude:n}=o.userLocation;if(t>35&&t<72&&n>-25&&n<45)return"EU_GENERIC";if(t>25&&t<72&&n>-170&&n<-50)return"US"}return"GLOBAL"}function te(e,t){const n=t==="New"?"#007AFF":"#34C759";return e.includes("shopee")?{color:"#EE4D2D",icon:"https://upload.wikimedia.org/wikipedia/commons/f/fe/Shopee.svg"}:e.includes("lazada")?{color:"#0F1568",icon:"https://upload.wikimedia.org/wikipedia/commons/4/4d/Lazada_Logo.svg"}:e.includes("amazon")?{color:"#FF9900",icon:"https://upload.wikimedia.org/wikipedia/commons/4/4a/Amazon_icon.svg"}:e.includes("tiki")?{color:"#1A94FF",icon:"https://upload.wikimedia.org/wikipedia/commons/archive/2/29/20210626071536%21Tiki_logo.png"}:e.includes("ebay")?{color:"#E53238",icon:"https://upload.wikimedia.org/wikipedia/commons/1/1b/EBay_logo.svg"}:e.includes("facebook")?{color:"#1877F2",icon:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/2021_Facebook_icon.svg/512px-2021_Facebook_icon.svg.png"}:{color:n,icon:null}}function oe(){const e=o.actualSearchTerm||o.detectedCategory||"Produit",t=e.charAt(0).toUpperCase()+e.slice(1),n=ee();if(g.innerHTML=`
    <div style="padding: 10px; margin-bottom: 5px;">
      <h3 style="margin-bottom: 5px;">Offres en ligne pour "${t}"</h3>
      <p style="color: #666; font-size: 0.9rem;">
        üåç Boutiques identifi√©es pour : <strong>${n}</strong>
      </p>
    </div>
  `,o.aiRecommendations&&o.aiRecommendations.length>0){const i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.gap="12px",o.aiRecommendations.forEach(a=>{const r=te(a.url,a.type),l=r.icon?`<img src="${r.icon}" style="width:100%; height:100%; object-fit:contain;" alt="${a.name}">`:`<div style="font-weight:bold; font-size:20px; color:${r.color}">${a.name.charAt(0)}</div>`,c=document.createElement("div");c.className="place-card online-result",c.style.borderLeft=`4px solid ${r.color}`,c.style.minHeight="80px";let u=a.type==="New"?"#007AFF":"#34C759",f=a.type==="New"?"NEUF":"OCCASION";c.innerHTML=`
            <div style="width: 60px; height: 60px; flex-shrink:0; display: flex; align-items: center; justify-content: center; background: white; border-radius: 12px; padding: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-right: 15px;">
               ${l}
            </div>
            <div class="place-details" style="flex:1;">
              <div class="place-name" style="font-size:1.05rem; margin-bottom:4px;">${a.name}</div>
              <div class="place-address" style="font-size:0.85rem; color:#666;">Site marchand sp√©cialis√©</div>
              <div style="display:flex; align-items:center; justify-content:space-between; margin-top:8px;">
                 <span style="font-size:10px; font-weight:700; color:${u}; background:${u}15; padding:3px 8px; border-radius:4px;">${f}</span>
                 <a href="${a.url}" target="_blank" class="online-link-btn" style="background: ${r.color}; font-size:0.9rem; padding: 6px 16px; margin:0;">Voir l'offre</a>
              </div>
            </div>
          `,i.appendChild(c)}),g.appendChild(i)}else g.innerHTML+=`
        <div style="text-align:center; padding:40px; color:#888;">
           <p>Aucune offre sp√©cifique trouv√©e pour l'instant.</p>
           <button class="reset-fab" style="position:static; transform:none; margin-top:20px;" onclick="window.open('https://www.google.com/search?tbm=shop&q=${encodeURIComponent(e)}', '_blank')">Chercher sur Google Shopping</button>
        </div>
      `;const s=document.createElement("div");s.className="place-card ad-card",s.style.marginTop="20px",s.innerHTML=`
      <div class="ad-label">Publicit√©</div>
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-9057470154911774"
           data-ad-slot="9453283378"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script>
  `,g.appendChild(s)}
